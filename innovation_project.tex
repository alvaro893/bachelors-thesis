%----------------------------------------------------------------------------------------
%	Metropolia Thesis LaTeX Template
%----------------------------------------------------------------------------------------
% License:
% This work is licensed under the Creative Commons Attribution 4.0 International License. To view a copy of this license, visit http://creativecommons.org/licenses/by/4.0/.
%
% Authors:
% Panu Leppäniemi, Patrik Luoto and Patrick Ausderau
%
% Credits:
% Panu Leppäniemi: abstract, def, cleaning,...
% Patrik Luoto: title page, abstract in Finnish, abbreviation, math,...
% Patrick Ausderau: initial version, style, table of content, bibliography, figure, appendix, table, source code listing...
%
% Please:
% If you find mistakes, improve this template and alike, please contribute by sharing your improvements and/or send us your feedback there: https://github.com/panunu/metropolia-thesis-latex
% And of course, if you improve it, add yourself as an author.
%
% Compiler:
% Use XeLaTeX as a compiler.

%----------------------------------------------------------------------------------------
%    ToDo
%----------------------------------------------------------------------------------------
% % % TÄRKEÄT
% % Odotetaan 29.11.2013 asti äikänmaikkojen ja viestinnän mahdollisia kommentteja.
%   %done?
%
% % % Vähemmän tärkeät


%----------------------------------------------------------------------------------------
%	TITLE PAGE CONFIGURATION
%----------------------------------------------------------------------------------------

\def\thesislang{english} %change this depending on your language
\author{Álvaro Bolaños Rodríguez}
\def\thesis{Innovation Project}
\def\alaotsikko{Innovation Project}

%Finnish section
\def\otsikko{Opinnäytetyön otsikko}
\def\tutkinto{Tutkinto}
\def\kohjelma{Koulutusohjelma}
\def\suuntautumis{Suuntautumisvaihtoehto}
\def\ohjaajat{
	Etunimi Sukunimi, Titteli\newline
	Etunimi Sukunimi, Titteli
}
\def\avainsanat{avainsanat}
\def\pvm{\specialdate\today}

%English section, for abstract
\title{body temperature measurement with IR camera}
\def\metropoliadegree {Bachelor of Engineering}
\def\metropoliadegreeprogramme {Information Technology}
\def\metropoliaspecialisation {Software Engineer}
\def\metropoliainstructors {
	Antti Piironen, Title \newline
}
\def\metropoliakeywords {Keywords}
\date{\today}

%----------------------------------------------------------------------------------------
%	GLOBAL STYLES
%----------------------------------------------------------------------------------------

\documentclass[hidelinks,11pt,a4paper,oneside,article]{memoir}
\usepackage[\thesislang]{babel} 
\usepackage{iflang}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{fontspec}
\usepackage{tocloft}
\usepackage{titlesec}
\usepackage[hyphens]{url}
\usepackage{mathtools}
\usepackage{wallpaper}
\usepackage{datetime}
\usepackage[bookmarksdepth=subsection]{hyperref} % for automagic pdf links for toc, refs, etc.
\usepackage[amssymb]{SIunits}
\usepackage[version=3]{mhchem}
\usepackage{pgfplots} %simple plots etc
\usepackage{pgfplotstable}
\usepackage{tikz} % mindmaps, flowcharts, piecharts, examples at http://www.texample.net/tikz/examples/
\usepackage{csquotes}
\usetikzlibrary{shapes.geometric, arrows}


\renewcommand{\dateseparator}{.}
%condition for adding or not space in TOC
\usepackage{etoolbox}
%for compact list
\usepackage{enumitem}
%for block comment
\usepackage{verbatim}
%for "easier" references
\usepackage{varioref}
%forcing single line spacing in bibliography
\DisemulatePackage{setspace}
\usepackage{setspace}
%including figure (image)
\usepackage{graphicx}
%change the numbering for figure
\usepackage{chngcntr}
%strike trough
\usepackage{ulem}
%euro symbol
\usepackage{eurosym}
%try to count
\usepackage{totcount}
%insert source code
\usepackage{listings}
\usepackage[justification=justified,singlelinecheck=false]{caption}
\usepackage{color}
%force the width of a table instead of column
\usepackage{tabularx}
\usepackage{booktabs} %why not booktabs? :3
% Abbreviations, acronym and glossary
\usepackage[acronym,nonumberlist,section]{glossaries}%xindy,%toc, ,nomain

\usepackage{float} % For forced figure location with modifier H (\begin{figure}[H])
\usepackage{cite} % Make citations to match Metropolia thesis guide

% change font of links in bibliography to same as other text
\usepackage{url}
\urlstyle{same}

% change punctuation of multiple cites to semicolon instead of comma: [1; 2; 3]
\renewcommand\citepunct{; }

% citep-macro for reference with period inside square brackets [1.]
\newcommand{\citep}[1]{
	\renewcommand\citeright{.]}
	\cite{#1}
	\renewcommand\citeright{]}
}

%set date format to D.M.YYYY
\newdateformat{specialdate}{\THEDAY.\THEMONTH.\THEYEAR}

\newcommand\tn[1]{\textnormal{#1}} %use \tn instead of \textnormal
\newcommand\reaction[1]{\begin{equation}\ce{#1}\end{equation}} %\reaction{} for chemical reactions

%NORMAL TEXT
%all text, title, etc. in the same font: Arial
%replace with arial.ttf if you have the fontfile
\setmainfont
[BoldFont=LiberationSans-Bold.ttf,
ItalicFont=LiberationSans-Italic.ttf,
BoldItalicFont=LiberationSans-BoldItalic.ttf]
{LiberationSans-Regular.ttf}
%line space
\linespread{1.5}
%\doublespacing
%margin
\usepackage[top=2.5cm, bottom=3cm, left=4cm, right=2cm, nofoot]{geometry}
\setlength{\parindent}{0pt} %first line of paragraph not indented
\setlength{\parskip}{16.5pt} %one empty line to separate paragraph
%list with small line space separation
\tightlists

%IMAGE - FIGURE
%the figures should be placed in the "illustration" folder
\graphicspath{{illustration/}}
%figure number without chapter (1.1, 1.2, 2.1) to (1, 2, 3)
\counterwithout{figure}{chapter}
%border around images
\setlength\fboxsep{0pt}
\setlength\fboxrule{0.5pt}
%caption font size
\captionnamefont{\small}
\captiontitlefont{\small}
%space after figure caption (and other float elements)
\setlength{\belowcaptionskip}{-7pt}

%TABLE
\counterwithout{table}{chapter}

%SOURCE CODE
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}
\lstset{
	extendedchars=true,
	captionpos=b,
	caption=\footnotesize,
	basicstyle=\singlespacing\ttfamily,%\small\fontfamily{"Courier"}\selectfont,
	keywordstyle=\color{blue}\bfseries,
	commentstyle=\color{purple}\itshape,
	identifierstyle=\color{black},
	stringstyle=\color{red},
	showstringspaces=false,
	showspaces=false,
	numbers=left,
	numberstyle=\footnotesize,
	numbersep=9pt,
	breaklines=true,
	tabsize=2,
	showtabs=false,
	xleftmargin=1cm
}
\IfLanguageName {finnish} {\renewcommand{\lstlistingname}{Listaus}} {} % what is a good translation for this?
%\counterwithout{lstlisting}{chapter}
%moved after begin document, otherwise does not compile

%% set this format as the default for lstlisting
%\DeclareCaptionFormat{empty}{}
%\captionsetup[lstlisting]{format=empty}

%TOC
%change toc title
\IfLanguageName {finnish} {\addto{\captionsfinnish}{\renewcommand*{\contentsname}{Sisällys}}} {}
%remove dots
\renewcommand*{\cftdotsep}{\cftnodots}
%chapter title and page number not in bold
\renewcommand{\cftchapterfont}{}
\renewcommand{\cftchapterpagefont}{}
%sub section in toc
\setcounter{tocdepth}{2}
%subsection numbered
\setcounter{secnumdepth}{2}
\renewcommand{\tocheadstart}{\vspace*{-15pt}}
\renewcommand{\printtoctitle}[1]{\fontsize{13pt}{13pt}\bfseries #1}
\renewcommand{\aftertoctitle}{\vspace*{-22pt}\afterchaptertitle}
%spacing afer a chapter in toc
\preto\section{%
	\ifnum\value{section}=0\addtocontents{toc}{\vskip11pt}\fi
}
%spacing afer a section in toc
\renewcommand{\cftsectionaftersnumb}{\vspace*{-3pt}}
%spacing afer a subsection in toc
\renewcommand{\cftsubsectionaftersnumb}{\vspace*{-1pt}}
%appendix in toc with "Appendix " + num
\IfLanguageName {finnish} {
	\renewcommand*{\cftappendixname}{Liite\space}
	\renewcommand{\appendixtocname}{Liitteet}
}{\renewcommand*{\cftappendixname}{Appendix\space}}
%appendix header
\IfLanguageName {finnish} {\def\appname{Liite\space}}{\def\appname{Appendix\space}}

%TITLES
%chapter title
\titleformat{\chapter}
{\fontsize{13pt}{13pt}\bfseries\linespread{1}}
{\thechapter}{.5cm}{}
\titlespacing*{\chapter}{0pt}{.32cm}{9pt}
\titleformat{\section}
{\fontsize{12pt}{12pt}\linespread{1}}
{\thesection}{.5cm}{}
\titlespacing*{\section}{0pt}{14pt}{6pt}
\titleformat{\subsection}
{\fontsize{12pt}{12pt}\linespread{1}}
{\thesubsection}{.5cm}{}
\titlespacing*{\subsection}{0pt}{14pt}{6pt}


%QUOTE
\renewenvironment{quote}
{\list{}{\rightmargin=0pt\leftmargin=1cm\topsep=-10pt}%
	\item\relax\fontsize{10pt}{10pt}\singlespacing}
{\endlist}

%BIBLIOGRAPHY
%bibliography title to be "references"
%if the title don't get renamed properly, move that line after the \begin{document}
\IfLanguageName {finnish} {\addto{\captionsfinnish}{\renewcommand*{\bibname}{Lähteet}}} {\renewcommand\bibname{References}}
\makeatletter %reference list option change
\renewcommand\@biblabel[1]{#1\hspace{1cm}} %from [1] to 1 with 1cm gap
\makeatother %
\setlength{\bibitemsep}{11pt}

%count the appendices (since the chapter counter is reset after \appendix).
%! require to complie 2 times
\regtotcounter{chapter}

%ABBREVIATION AND GLOSSARY
% Generate the glossary
\makeglossaries

%Acronyms, abbreviations, etc. definitions
\newacronym{html}{HTML}{HyperText Markup Language}
\newacronym{sql}{SQL}{Structured Query Language}
\newacronym{io}{I/O}{Input/Output}
\newacronym{ram}{RAM}{Random Access Memory}
\newacronym{php}{PHP}{Hypertext Preprocessor}
\newacronym{lte}{LTE}{Long Term Evolution}
\newacronym{3g}{3G}{Third generation}
\newacronym{ir}{IR}{Infrared}
\newacronym{iot}{IoT}{Internet of Things}
\newacronym{usb}{USB}{Universal Serial Bus}
\newacronym{otg}{OTG}{On The Go}
\newacronym{sim}{SIM}{subscriber identity module}
\newacronym{spi}{SPI}{Serial Peripheral Interface}
\newacronym{api}{API}{Application Program Interface}


%Glossary entries
\newglossaryentry{part_key}{
	name={partition key}, 
	description={a column or set of columns from the same table whose consolidated value decide the partition for a given data}
}
\newglossaryentry{thesis}{
	name=thesis, 
	description={a written essay one submitted for a university degree},
	plural=theses
}
\newglossaryentry{latex}
{
	name=\LaTeX{},
	description={Is a mark up language specially suited for scientific documents}
}

\newglossaryentry{maths}
{
	name=mathematics,
	description={Mathematics is what mathematicians do}
}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------
\makeatletter
\renewcommand{\maketitle}{
	\thispagestyle{empty}
	\ThisCenterWallPaper{1}{viiva}
	%
	\vspace*{9.5cm}
	\tn{\LARGE\@author\\[22pt]\Huge\IfLanguageName {finnish}{\otsikko}{\@title}\\[22pt]\LARGE\alaotsikko\\[1.75cm]}
	
	\parbox{.7\linewidth}{
		\IfLanguageName {finnish}{
			Metropolia Ammattikorkeakoulu\\
			\tutkinto \\
			\kohjelma \\
			\thesis\\
			\pvm
		} {
			Helsinki Metropolia University of Applied Sciences\\
			\metropoliadegree \\
			\metropoliadegreeprogramme \\
			\thesis\\
			\specialdate\today % D.M.YYYY date format
		}
	}
	\ThisLRCornerWallPaper{1}{metropolia}
	%
	\clearpage
}
\makeatother

\makepagestyle{tiivis}
\makeevenhead{tiivis}{}{}{Tiivistelmä}
\makeoddhead{tiivis}{}{}{Tiivistelmä}

\makepagestyle{abstract}
\makeevenhead{abstract}{}{}{Abstract}
\makeoddhead{abstract}{}{}{Abstract}

\begin{document}
	\counterwithout{lstlisting}{chapter}
	
	%page number always on the top right, clear the "chapter/section" head
	\pagestyle{myheadings}
	\markright{}
	%clear chapter "title" foot page
	\makeevenfoot{plain}{}{}{}
	\makeoddfoot{plain}{}{}{}
	
	
	
	\maketitle
	\newpage
	\LRCornerWallPaper{1}{footer}
	
	%----------------------------------------------------------------------------------------
	%	ABSTRACT
	%----------------------------------------------------------------------------------------
	
	\pagestyle{abstract}
	\begin{tabular}{ | p{4,7cm} | p{10,3cm} |}
		\hline
		Author(s) \newline
		Title \newline\newline 
		Number of Pages \newline
		Date
		& 
		\makeatletter
		\@author \newline
		\@title \newline\newline
		\pageref*{LastPage} pages + \total{chapter} appendices \newline %! if no appendices, risk to count total of chapter :D
		\IfLanguageName {finnish} {\foreignlanguage{english}{\longdate\@date}} {\@date}
		\makeatother
		\\ \hline
		Degree & \metropoliadegree
		\\ \hline
		Degree Programme & \metropoliadegreeprogramme
		\\ \hline
		Specialisation option & \metropoliaspecialisation
		\\ \hline
		Instructor(s) & \metropoliainstructors
		\\ \hline
		\multicolumn{2}{|p{15cm}|}{\begin{singlespacing}\vspace{-22pt}
				This is the abstract
				
		\end{singlespacing}} \\[14cm] \hline
		Keywords & \metropoliakeywords
		\\ \hline
	\end{tabular}
	\clearpage
	
	%----------------------------------------------------------------------------------------
	%	Acknowledgement ?
	%----------------------------------------------------------------------------------------
	%\chapter*{Acknowledgement}
	%Thanks to my cat
	%\clearpage
	
	%----------------------------------------------------------------------------------------
	%	TABLE OF CONTENTS
	%----------------------------------------------------------------------------------------
	
	\makeevenhead{plain}{}{}{}
	\makeoddhead{plain}{}{}{}
	\pagestyle{empty} %remove page number in toc (if longer than 2 pages)
	\tableofcontents*
	\pagestyle{empty} %remove page number in toc (if longer than 1 pages)
	
	
	\clearpage
	%Uncomment this line if you do not have Abbreviations list.
	%\pagestyle{plain}
	
	%list of figure, tables comes here...
	
	
	%----------------------------------------------------------------------------------------
	%    Lyhenteet / Abbreviation
	%----------------------------------------------------------------------------------------
	
	\begin{singlespacing}
		
		\glsaddall
		
		{
			\titleformat{\section}
			{\fontsize{13pt}{13pt}\bfseries\linespread{1}}
			{\thesection}{.5cm}{}
			%Adapt labelwidth (sorry for the ugly hack)
			\setlist[description]{leftmargin=!, labelwidth=4em}
			\IfLanguageName {finnish} {
				\printacronyms[title=Lyhenteet]
			}{
				\printacronyms[title=Abbreviations]
			}
			\setlist[description]{leftmargin=!, labelwidth=7em}
			\printglossary 
			\setlist[description]{style=standard} % reset settings back to default
		}
	\end{singlespacing}
	%Seems that bug is in sharelatex. Compile fine with TexLive >= 2014
	
	
	\newpage
	
	%page number always on top right; also for chapter "title" page
	\pagestyle{plain}
	\makeevenhead{plain}{}{}{\thepage}
	\makeoddhead{plain}{}{}{\thepage}
	
	\setcounter{page}{1} %page 1 should be Introduction
	\ClearWallPaper
	%----------------------------------------------------------------------------------------
	%	CONTENT
	%----------------------------------------------------------------------------------------
	
	\sloppy % enforce alignment to fully justified
	
	\chapter{Introduction}
	
	

	
	\section{Raspberry Pi and Lte dongle}
	
	\chapter{Connectivity Methods: protocols}
	
	\section{UDP}
	
	\subsection{The NAT problem}
	
	\section{http/s}
	\cite{http-rfc}
	
	\section{Websockets}
	\cite[p.~30]{rfc6455}
	
	\chapter{Theoretical Background}
	\chapter{Methods and Materials}
	\chapter{Results}
	\chapter{Discussion}
	\chapter{Conclusions}
	
	
	
	
	
	%----------------------------------------------------------------------------------------
	%   BIBLIOGRAPHY 
	%----------------------------------------------------------------------------------------
	
	\IfLanguageName{finnish}{\bibliographystyle{vancouver_fi}}{\bibliographystyle{vancouver}}
	%line space
	%\singlespacing %removed otherwise the appendix are also single space
	\begin{flushleft}
		\begin{singlespacing}
			\bibliography{biblio}
		\end{singlespacing}
	\end{flushleft}
	
	%for conting the pages
	\label{LastPage}~
	
	
	%----------------------------------------------------------------------------------------
	%   APPENDICES 
	%----------------------------------------------------------------------------------------
	%avoid that the last page of bib get appendix header
	\clearpage
	%start appendix
	\appendix
	%no page number for appendix in table of content
	\addtocontents{toc}{\cftpagenumbersoff{chapter}}
	%appendix sections and subsections not in table of content
	\settocdepth{chapter}
	%add "Appendices" in the table of content
	\addappheadtotoc
	%force smaller vertical spacing in table of content
	%!!! There can be some fun depending if the appendices have (sub)sections or not :D
	% You will have to play with these numbers and eventually copy the \pretocmd line on before some \chapter and force another number.
	\addtocontents{toc}{\vspace{11pt}}
	\pretocmd{\chapter}{\addtocontents{toc}{\protect\vspace{-24pt}}}{}{}
	%have Appendix 1 (instead of Appendix A)
	\renewcommand{\thechapter}{\arabic{chapter}} 
	
	\newcommand\liite[1]{
		%each appendix restart page num to one
		\setcounter{page}{1}
		%special counter for appendix TODO: this is a ugly quick hack :( Should find a better way to count the page per appendix.
		\newtotcounter{appx#1}
		%overwrite the header
		\makeevenhead{plain}{}{}{\appname \thechapter \\ \thepage\,(\stepcounter{appx#1}\total{appx#1})}
		\makeoddhead{plain}{}{}{\appname \thechapter \\ \thepage\,(\stepcounter{appx#1}\total{appx#1})}}
	
	\liite{1}
	\chapter{Appendix}\label{appx:first}
	
	% Note that every appendix will be a chapter.
	
	% Sorry for the ugly hack on how to count the total pages per appendix.
	
	
	% Of course with section and subsection.
	
	\section{Appendix Section}
	
	% And you can cite \cite{tobias:book} stuff, it will go into the main bibliography.
	
	\subsection{With a Subsection}
	
	\clearpage % avoid that the last page of previous appendix get this header
	\liite{2}
	
	
	
	\chapter{Appendix 2}\label{appx:second}
	\addtocontents{toc}{\vspace{11pt}}
	
	content here 
	
	\clearpage
	\liite{3}
\end{document}
